<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./assets/img/favicon.ico">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="./assets/css/helpers.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- Script Vue Js -->
    <script src="./assets/js/vue.3.2.47.js"></script>
    <title>Boolzapp</title>
</head>
<body>
    <!-- Vue JS App -->
    <div id="app">
        <main class="dFlex alignCtr justyCtr vh100">
            <section class="container dFlex wid100Perc">
                <!-- All Chat Section -->
                <div id="allChatSec" class="dFlex flexColumn">
                    <!-- User profile and icons -->
                    <div id="userProfileSec" class="bgGrey dFlex spaceBtw alignCtr pad05em">
                        <div class="dFlex alignCtr gap1em">
                            <img :src="userProfile.avatar" width="45" :alt="userProfile.name" class="borderRadius50">
                            <span>{{userProfile.name}}</span>
                        </div>
                        <div>
                            <button class="marginLat05em"><i class="changeColTealHov cPointer fa-xl fa-solid fa-circle-notch txtGrey"></i></button>
                            <button class="marginLat05em"><i class="changeColTealHov cPointer fa-xl fa-solid fa-message txtGrey"></i></button>
                            <button class="marginLat05em"><i class="changeColTealHov cPointer fa-xl fa-solid fa-ellipsis-vertical txtGrey"></i></button>
                        </div>
                    </div>
                    <!-- CTA Boolzapp notifications -->
                    <div id="ctaNotifSec" class="bgLightBlue dFlex alignCtr gap1em pad1rem">
                        <div class="bgWhite borderRadius50 pad05em">
                            <i class="fa-solid fa-bell-slash txtBlue fa-fw"></i>
                        </div>
                        <div>
                            <p>Ricevi notifiche di nuovi messaggi</p>
                            <small><a href="#" class="txtUnderline txtGrey">Attiva notifiche desktop</a></small>
                        </div>
                    </div>
                    <!-- Search Bar -->
                    <div id="searchBarSec" class="bgLightGrey dFlex alignCtr pad05em">
                        <form class="wid100Perc">
                          <input class="wid100Perc txtGrey borderRadius" type="search" placeholder="Cerca o inizia una nuova chat" v-model="newSearch" @keyUp="chatSearch">
                        </form>
                    </div>
                    <!-- Single conversations -->
                    <div id="singleChatSec" class="bgWhite fGrow1">
                        <template v-for="(friend, i) in contacts">
                            <div v-if="friend.visible === true" @click="currentChat=i" class="dFlex alignCtr spaceBtw pad05em borderBottom cPointer changeBackTealHov" :class="currentChat === i ? 'activeChat' : null">
                                <div class="dFlex alignCtr gap1em">
                                    <img :src="friend.avatar" :alt="friend.name" width="45" class="borderRadius50">
                                    <p>
                                        <span>{{friend.name}}</span>
                                        <small v-show="friend.messages.length > 0" class="txtGrey displayBlock marginTopBot">{{friend.messages.length > 0 ? friend.messages[friend.messages.length-1].message : null}}</small>
                                    </p>
                                </div>
                                <div class="chatTime">
                                    <small v-show="friend.messages.length > 0" class="txtGrey">{{friend.messages.length > 0 ? lastAccess(friend) : null}}</small>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>    
                <!-- Active Chat Section -->
                <div id="activeChatSec" class="fGrow1 dFlex flexColumn">
                    <!-- Top Banner: Chat friend and buttons -->
                    <div id="topBannerActiveChat" class="bgGrey dFlex spaceBtw alignCtr pad05em">
                         <div class="dFlex alignCtr gap1em">
                            <img :src="contacts[currentChat].avatar" width="45" :alt="contacts[currentChat].name" class="borderRadius50">
                            <p>
                                <span>{{contacts[currentChat].name}}</span>
                                <small v-show="contacts[currentChat].messages.length > 0" :class="userLastLogClass" class="txtGrey displayBlock marginTopBot">Ultimo accesso oggi alle {{contacts[currentChat].messages.length > 0 ? lastAccess() : null}}</small>
                                <small v-show="contacts[currentChat].messages.length > 0"  :class="userStatusClass" class="txtGrey displayBlock marginTopBot">{{userStatusTxt}}</small>
                            </p>
                        </div>
                        <div class="posRelative">
                            <button class="marginLat05em"><i class="changeColTealHov cPointer txtGrey fa-xl fa-solid fa-magnifying-glass"></i></button>
                            <button class="marginLat05em"><i class="changeColTealHov cPointer txtGrey fa-xl fa-solid fa-paperclip"></i></button>
                            <!-- Chat Dropdown Menu -->
                            <button class="marginLat05em"><i class="changeColTealHov cPointer fa-xl fa-solid fa-ellipsis-vertical txtGrey" @click="chatMenuVisibility = !chatMenuVisibility"></i></button>
                            <div v-show="chatMenuVisibility" id="chatDropdown" class="bgGrey posAbsolute borderRadius">
                                <a href="#" v-show="contacts[currentChat].messages.length > 0" class="displayBlock marginTopBot changeColTealHov pad05em txtRed" @click="clearChat(), chatMenuVisibility = false"><i class="fa-regular fa-comments"></i> Elimina messaggi</a>
                                <a href="#" class="displayBlock marginTopBot changeColTealHov pad05em txtRed" @click="deleteChat(), chatMenuVisibility = false"><i class="fa-solid fa-trash-can"></i> Elimina chat</a>
                            </div>
                        </div>
                    </div>
                    <!-- Chat with messages -->
                    <div id="chatMessagesSec" class="fGrow1 pad2rem dFlex flexColumn gap1em">
                        <template v-for="(mess, i) in contacts[currentChat].messages">
                            <div v-show="contacts[currentChat].messages.length > 0" class="dFlex" :class="mess.status === 'sent' ? 'msgSent' : 'msgReceived'">
                                <div class="borderRadius05 posRelative" @mouseover="showBtnMenu(i)" @mouseleave="hideBtnMenu">
                                    <span>{{mess.message}}</span>
                                    <small class="displayBlock txtAlignRight txtGrey"><i v-show="mess.star === true" class="fa-xs fa-solid fa-star"></i> {{messTime(mess)}}</small>
                                    <!-- Message Dropdown Menu -->
                                    <button :class="mess.status === 'sent' ? 'bgGreen' : 'bgWhite', currentMouseover != i ? 'dNone' : null" class="cPointer posAbsolute displayBlock txtAlignRight txtGrey" @click="showMenu(i)"><i class="changeColTealHov fa-lg fa-solid fa-chevron-down txtGrey"></i></button>
                                    <div id="msgDropdown" class="bgGrey posAbsolute borderRadius" :class="msgMenuVisibility != i ? 'dNone' : null">
                                        <a href="#" class="displayBlock marginTopBot changeColTealHov pad05em" @click="mess.star = !mess.star, msgMenuVisibility = null"><i class="fa-regular fa-star"></i> Preferiti</a>
                                        <a href="#" class="displayBlock marginTopBot changeColTealHov pad05em" @click="msgMenuVisibility = null"><i class="fa-solid fa-share fa-flip-horizontal"></i> Rispondi</a>
                                        <a href="#" class="displayBlock marginTopBot changeColTealHov pad05em txtRed" @click="removeMessage(i)"><i class="fa-solid fa-trash-can"></i> Elimina</a>
                                    </div>
                                    <!-- Message Speech Bubbles -->
                                    <div :class="mess.status != 'sent' ? 'bubbleReceived' : null" class="bubble posAbsolute"></div>
                                </div>
                            </div>
                        </template>              
                    </div>
                    <!-- Send new message -->
                    <div id="sendMessSec" class="dFlex alignCtr spaceBtw pad05em">
                        <div>
                            <button class="marginLat1em"><i class="changeColTealHov cPointer txtGrey fa-xl fa-regular fa-face-smile"></i></button>
                        </div>
                        <div class="wid100Perc dFlex justyCtr">
                            <input :class="inputErrorClass" class="txtGrey borderRadius marginLat1em" type="text" placeholder="Scrivi un messaggio" v-model="newMessage.message" @keyup.enter="addMessage">
                        </div>
                        <div>
                            <button class="marginLat1em"><i class="changeColTealHov cPointer txtGrey fa-xl fa-solid fa-microphone"></i></button>
                        </div>
                    </div>
                </div>   
            </section>  
        </main>
    </div>
    <!-- Script Luxon JS -->
    <script src="./assets/js/luxon.js"></script>
    <!-- Script App JS -->
    <script src="./assets/js/app.js"></script>
</body>
</html>